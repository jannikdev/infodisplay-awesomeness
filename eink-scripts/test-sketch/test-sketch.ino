#include <Basecamp.hpp>

#include <GxEPD.h>

#include <GxGDEW075T8/GxGDEW075T8.h>      // 7.5" b/w
//#include <GxGDEW075Z09/GxGDEW075Z09.h>    // 7.5" b/w/r
//#include <GxGDEW075Z08/GxGDEW075Z08.h>    // 7.5" b/w/r 800x480
#include <Fonts/FreeMonoBold9pt7b.h>
#include <Fonts/FreeMonoBold12pt7b.h>
#include <Fonts/FreeMonoBold18pt7b.h>
#include <Fonts/FreeMonoBold24pt7b.h>

#include <GxIO/GxIO_SPI/GxIO_SPI.h>
#include <GxIO/GxIO.h>

#if defined(ESP8266)

// for SPI pin definitions see e.g.:
// C:\Users\xxx\AppData\Local\Arduino15\packages\esp8266\hardware\esp8266\2.4.2\variants\generic\common.h

GxIO_Class io(SPI, /*CS=D8*/ SS, /*DC=D3*/ 0, /*RST=D4*/ 2); // arbitrary selection of D3(=0), D4(=2), selected for default of GxEPD_Class
GxEPD_Class display(io, /*RST=D4*/ 2, /*BUSY=D2*/ 4); // default selection of D4(=2), D2(=4)
// Heltec E-Paper 1.54" b/w without RST, BUSY
//GxEPD_Class display(io, /*RST=D4*/ -1, /*BUSY=D2*/ -1); // no RST, no BUSY

#elif defined(ESP32)

// for SPI pin definitions see e.g.:
// C:\Users\xxx\Documents\Arduino\hardware\espressif\esp32\variants\lolin32\pins_arduino.h

GxIO_Class io(SPI, /*CS=5*/ SS, /*DC=*/ 17, /*RST=*/ 16); // arbitrary selection of 17, 16
GxEPD_Class display(io, /*RST=*/ 16, /*BUSY=*/ 4); // arbitrary selection of (16), 4

#else

// for SPI pin definitions see e.g.:
// C:\Users\xxx\AppData\Local\Arduino15\packages\arduino\hardware\avr\1.6.21\variants\standard\pins_arduino.h

GxIO_Class io(SPI, /*CS=*/ SS, /*DC=*/ 8, /*RST=*/ 9); // arbitrary selection of 8, 9 selected for default of GxEPD_Class
GxEPD_Class display(io, /*RST=*/ 9, /*BUSY=*/ 7); // default selection of (9), 7

#endif

#define FactorSeconds 1000000LL

Basecamp iot;
AsyncClient client;

int counter;
char* serverUrl = "172.16.1.60";
char* dataPath = "/static/outputs/content.txt";
int sleeptime = 120;
boolean wasUpdated = false;
int touchPinLeft = 2;
int touchPinRight = 27;
int touchPinBottom = 13;

int touchValueLeft = 100;
int touchValueBottom = 100;
int touchValueRight = 100;

int clockRendering = 120000;
int clockWebUpdate = 60000;
int baseClock = 0;

String displayValue = "0;0;0;0;0;";
int lengthPixel = 0;

String content = "272;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;204;3;12;3;413;5;202;7;8;7;14;14;10;14;114;6;157;7;41;11;23;5;202;8;6;8;14;14;10;14;112;8;26;38;35;37;18;12;35;20;18;5;28;33;140;9;6;9;13;14;10;14;110;10;26;38;35;37;17;15;30;27;14;5;28;37;136;10;4;10;13;14;10;14;109;11;26;38;35;37;15;18;27;32;11;5;28;39;134;10;4;10;13;14;10;14;107;13;26;38;35;37;14;20;24;37;8;5;28;41;132;10;5;9;19;8;17;7;106;14;26;38;35;37;14;21;22;13;8;18;7;5;28;42;131;9;6;9;19;8;17;7;38;8;58;16;26;37;36;37;13;10;2;10;21;11;15;14;7;5;35;9;13;14;131;8;7;7;20;8;17;7;38;8;57;17;26;37;36;36;14;8;6;9;19;10;19;12;7;5;35;9;16;11;132;5;10;5;21;8;17;7;38;8;55;10;1;8;26;5;25;7;36;5;24;7;13;8;9;7;18;10;21;11;7;5;35;9;17;11;172;8;17;7;38;8;55;9;2;8;26;5;24;7;37;5;24;7;13;7;10;7;17;10;23;10;7;5;35;9;18;10;172;8;17;7;38;8;55;7;4;8;26;5;24;7;37;5;23;7;14;6;12;6;16;10;25;9;7;5;35;9;19;10;171;8;17;7;38;8;55;6;5;8;26;5;23;7;38;5;23;7;14;6;12;6;16;9;27;8;7;5;35;9;19;10;171;8;17;7;38;8;55;4;7;8;26;5;23;7;38;5;22;7;15;6;12;6;15;9;28;8;7;5;35;9;19;10;171;8;17;7;38;8;55;3;8;8;26;5;22;7;39;5;22;7;15;6;12;6;14;10;29;7;7;5;35;9;20;9;171;8;17;7;38;8;55;1;10;8;26;5;22;7;39;5;22;7;15;6;12;6;14;9;30;7;7;5;35;9;20;9;171;8;17;7;38;8;66;8;53;7;65;7;16;7;10;7;13;10;31;6;7;5;35;9;20;9;171;8;17;7;38;8;66;8;52;7;66;7;16;8;8;8;13;9;32;6;7;5;35;9;20;9;25;10;100;10;26;8;17;7;38;8;66;8;52;7;65;7;18;8;6;9;13;9;32;6;7;5;35;9;19;10;21;17;15;19;11;6;12;16;15;17;22;8;17;7;10;19;3;27;53;8;51;7;66;7;18;22;13;10;32;6;7;5;35;9;19;10;20;20;13;19;11;7;11;16;13;20;21;8;17;7;10;19;3;27;53;8;51;7;65;7;20;20;14;9;46;5;35;9;19;10;18;24;11;19;11;7;11;16;11;24;19;8;17;7;10;19;3;27;53;8;51;6;66;7;21;19;14;9;46;5;35;9;18;10;18;26;10;19;10;8;11;16;10;26;18;8;17;7;10;19;3;27;53;8;50;7;66;7;21;18;15;9;46;5;35;9;18;10;17;10;8;10;9;19;10;9;10;16;9;10;8;10;17;8;17;7;10;19;3;27;53;8;50;7;65;7;24;14;16;10;46;5;35;9;16;11;17;9;11;10;12;9;16;9;16;5;13;10;10;10;16;8;17;7;14;8;16;8;66;8;49;7;66;7;25;12;17;10;46;5;35;9;15;11;17;9;13;9;13;8;15;10;15;6;12;10;13;9;15;8;17;7;13;8;17;8;66;8;49;7;65;7;30;4;21;10;46;5;35;9;8;17;18;9;14;9;12;8;15;11;14;6;12;9;14;10;14;8;17;7;12;8;18;8;66;8;48;7;66;7;55;10;46;5;35;33;18;9;16;8;12;9;14;11;14;5;12;9;16;9;14;8;17;7;11;8;19;8;66;8;48;7;65;7;56;10;46;5;35;30;21;8;17;9;12;8;13;12;13;6;12;8;18;9;13;8;17;7;10;8;20;8;66;8;48;7;65;7;56;9;47;5;35;32;18;9;18;8;12;8;13;13;12;6;11;9;18;9;13;8;17;7;9;7;22;8;66;8;47;7;66;7;56;9;47;5;35;34;16;9;18;9;11;9;12;13;12;5;12;9;18;9;13;8;17;7;8;7;23;8;66;8;47;7;65;7;57;9;47;5;35;9;11;16;13;9;19;9;12;8;11;14;11;6;11;9;20;9;12;8;17;7;7;7;24;8;66;8;46;7;66;7;57;9;47;5;35;9;16;12;12;9;19;9;12;8;11;5;1;9;10;6;11;9;20;9;12;8;17;7;6;7;25;8;66;8;46;7;65;7;58;10;46;5;35;9;18;11;11;9;20;8;12;9;10;5;1;9;10;5;12;9;20;9;12;8;17;7;5;7;26;8;66;8;45;7;66;7;58;10;46;5;35;9;20;10;10;9;20;8;13;8;9;6;2;8;9;6;12;9;20;9;12;8;17;7;4;7;27;8;66;8;45;7;66;7;58;10;46;5;35;9;20;10;10;9;20;9;12;8;9;5;3;9;8;6;12;9;20;9;12;8;17;7;2;10;26;8;66;8;45;7;65;7;59;10;46;5;35;9;21;10;9;38;12;9;8;5;3;9;8;5;13;9;21;8;12;8;17;7;1;12;25;8;66;8;44;7;66;7;59;10;46;5;35;9;22;9;9;38;13;8;7;6;4;8;7;6;13;9;21;9;11;8;17;20;25;8;66;8;44;7;65;7;60;10;46;5;35;9;22;10;7;39;13;8;7;5;5;9;6;6;13;9;21;9;11;8;17;21;24;8;66;8;43;7;66;7;61;9;46;5;35;9;22;10;7;39;13;9;6;5;5;9;6;5;13;9;22;9;11;8;17;22;23;8;66;8;43;7;65;7;62;9;46;5;35;9;22;10;8;8;44;8;5;6;6;8;5;6;14;9;21;9;11;8;17;11;2;9;23;8;66;8;43;7;65;7;62;10;45;5;35;9;22;10;8;9;43;8;5;5;7;8;5;6;14;9;21;9;11;8;17;10;3;10;22;8;66;8;42;7;66;7;62;10;45;5;35;9;23;9;8;9;43;9;4;5;7;9;4;5;15;9;20;9;12;8;17;9;5;10;21;8;66;8;42;7;65;7;64;9;45;5;35;9;22;10;8;9;44;8;3;6;8;8;3;6;15;9;20;9;12;8;17;8;7;10;20;8;66;8;41;7;66;7;64;9;31;8;6;5;35;9;22;10;8;9;44;8;3;5;9;8;3;6;15;9;20;9;12;8;17;7;8;10;20;8;66;8;41;7;65;7;66;9;30;8;6;5;35;9;22;10;8;9;44;9;2;5;9;9;2;5;16;9;20;9;12;8;17;7;9;10;19;8;66;8;40;7;66;7;66;9;29;9;6;5;35;9;22;10;8;9;45;8;1;6;10;8;1;6;16;9;20;9;12;8;17;7;10;10;18;8;66;8;40;7;66;6;68;9;28;8;7;5;35;9;22;10;9;8;21;7;17;8;1;5;11;8;1;6;17;9;19;9;12;8;17;7;11;10;17;8;66;8;40;7;65;7;68;9;27;9;7;5;35;9;22;9;10;9;20;7;17;14;11;14;18;9;18;9;13;8;17;7;11;10;17;8;66;8;39;7;66;7;69;9;26;8;8;5;35;9;21;10;10;9;20;7;18;13;12;13;18;9;18;9;13;8;17;7;12;10;16;8;9;6;51;8;39;7;32;6;27;7;71;9;24;9;8;5;35;9;20;11;11;9;18;7;19;12;13;13;19;9;16;9;14;8;17;7;13;10;15;8;8;7;51;8;38;7;31;9;26;7;71;10;22;9;9;5;35;9;20;10;12;9;18;7;19;12;13;12;20;9;16;9;14;8;17;7;14;9;15;8;8;7;51;8;38;7;31;10;24;7;73;10;20;9;10;5;35;9;18;12;13;9;16;7;21;11;14;11;21;9;14;9;15;8;17;7;14;10;14;8;8;6;52;8;38;6;31;11;24;7;74;11;16;10;11;5;35;9;16;13;15;9;14;8;21;10;15;11;22;9;12;9;16;8;17;7;15;10;13;8;8;6;52;8;37;7;31;11;24;7;76;11;12;11;12;5;35;9;11;17;16;11;10;9;22;10;15;10;23;10;10;10;16;8;17;7;16;10;13;8;6;7;42;28;27;7;31;11;23;7;78;14;3;15;13;5;28;43;18;12;6;10;24;9;16;9;24;12;5;11;11;20;4;20;5;20;8;9;4;8;42;28;26;7;32;11;23;7;79;30;14;5;28;41;22;25;25;8;17;9;26;25;12;20;4;20;5;20;8;20;43;28;26;7;33;10;22;7;82;26;16;5;28;39;25;23;26;8;17;8;28;22;14;20;4;20;5;20;9;18;44;28;25;7;34;9;23;7;84;22;18;5;28;36;30;19;29;7;18;7;30;19;15;20;4;20;5;20;10;16;140;7;118;17;20;5;96;15;95;14;99;13;144;2;126;4;27;5;102;3;107;2;109;4;308;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;635;5;363;3200;14005;1;634;6;633;7;633;8;632;8;632;8;115;12;81;21;110;21;72;19;181;8;113;14;77;30;100;30;64;27;177;8;112;15;74;37;92;37;59;31;175;8;110;17;72;43;84;43;54;36;173;8;109;18;70;46;80;48;50;40;134;1;9;1;26;8;29;1;77;20;68;48;77;53;47;42;170;8;26;1;79;21;67;49;76;55;44;46;136;1;31;8;34;1;69;23;66;50;76;56;42;48;130;1;2;6;1;1;26;8;28;7;67;25;64;19;13;20;76;22;14;21;40;19;12;19;131;8;27;8;27;8;66;26;63;17;18;18;76;19;19;20;38;18;17;17;130;8;2;1;24;8;27;8;64;28;62;16;22;16;76;17;23;19;36;17;20;17;128;10;26;8;26;9;63;29;61;15;26;14;76;16;26;18;34;17;23;16;128;10;25;8;25;10;61;31;60;15;28;13;76;14;29;17;33;17;25;15;128;10;1;1;23;8;24;11;60;32;60;13;30;13;76;13;31;17;32;16;27;15;128;10;24;8;23;12;58;17;2;15;59;13;32;12;76;13;32;16;31;16;29;15;128;10;23;8;23;11;58;16;4;15;58;13;34;11;76;12;33;17;29;16;30;15;128;11;20;13;19;10;59;16;5;15;57;14;34;11;76;11;35;16;29;16;31;15;128;11;15;21;13;1;1;10;59;14;7;15;57;13;36;10;76;11;35;16;28;16;32;16;128;10;12;26;12;10;60;13;8;15;56;13;37;10;76;10;37;16;27;15;34;15;128;10;9;31;9;12;59;11;10;15;56;13;37;10;76;10;37;16;26;16;35;15;129;10;4;38;4;11;61;10;11;15;55;13;38;10;76;10;37;16;26;16;35;15;129;10;2;42;2;10;2;1;59;8;13;15;54;14;39;9;76;9;39;15;26;15;36;15;129;65;63;7;14;15;54;13;125;9;39;15;25;16;37;15;129;64;63;5;16;15;53;14;125;9;39;15;25;16;37;15;130;29;5;28;64;4;17;15;53;14;125;9;39;15;25;15;38;16;130;22;15;23;65;2;19;15;53;13;174;15;24;16;38;16;129;1;1;18;22;19;86;15;52;14;174;15;24;16;39;15;128;1;2;16;26;16;1;1;85;15;52;14;174;15;24;16;39;15;130;13;33;15;85;15;51;14;175;15;24;16;39;16;128;13;36;13;85;15;51;14;175;15;24;16;39;16;127;13;36;1;1;14;83;15;51;14;175;15;24;16;39;16;126;12;2;1;38;13;83;15;51;14;174;16;24;15;40;16;125;12;45;11;82;15;50;14;175;15;25;15;40;17;123;12;46;12;81;15;50;14;175;15;24;16;40;17;123;11;46;1;1;11;81;15;50;14;175;15;24;16;40;17;122;11;50;11;80;15;50;14;174;15;25;16;40;17;101;1;19;11;52;11;22;1;56;15;49;15;174;15;25;16;40;17;99;4;18;10;54;11;17;4;57;15;49;15;173;15;26;16;40;17;98;7;15;10;7;4;45;10;14;8;56;15;49;14;19;10;144;16;27;15;40;18;96;11;12;9;3;15;39;11;11;11;55;15;49;14;14;21;137;16;28;16;39;18;96;16;6;33;34;1;1;9;6;16;55;15;49;14;11;27;133;16;29;16;39;18;96;19;2;35;35;9;4;18;55;15;48;15;8;32;130;16;30;16;39;18;96;20;1;37;34;30;55;15;48;15;6;36;127;16;31;16;39;18;96;60;6;1;25;30;55;15;48;15;5;39;123;17;32;16;39;18;97;61;30;28;57;15;48;15;3;42;42;8;69;19;33;16;39;18;96;1;3;59;1;1;28;26;58;15;48;15;2;45;38;12;62;22;35;16;38;19;98;1;3;58;29;23;3;1;57;15;48;15;1;18;7;22;36;14;51;31;37;16;37;19;104;29;10;17;2;1;27;20;63;15;48;30;14;20;34;16;50;29;39;16;37;19;109;19;20;15;28;13;69;15;48;28;18;19;33;17;49;26;42;16;37;19;112;15;23;13;28;11;71;15;48;26;22;18;31;18;49;23;45;16;36;20;112;13;27;12;27;9;2;1;70;15;47;26;24;17;31;18;49;27;42;16;35;20;88;8;13;1;2;12;28;12;27;9;73;15;47;25;26;17;29;20;48;29;40;16;35;20;80;24;5;1;1;11;33;11;26;8;73;15;47;24;28;17;28;20;48;32;38;16;33;21;77;30;4;10;35;11;25;8;73;15;47;23;30;16;28;20;48;34;36;16;33;21;75;33;2;10;36;12;24;8;73;15;47;23;31;16;27;20;60;23;36;16;31;22;74;46;37;11;24;8;73;15;47;22;32;17;26;20;65;20;34;16;30;23;71;47;40;10;24;8;73;15;47;21;34;16;26;20;67;19;34;16;29;23;69;49;1;1;37;1;1;9;24;8;73;15;47;21;34;16;27;18;70;18;33;17;27;24;68;49;41;1;1;9;23;8;73;15;47;21;35;16;26;18;72;17;33;17;25;25;65;1;1;49;1;1;42;9;23;8;73;15;47;20;36;16;27;16;74;17;33;17;23;26;65;17;20;14;44;10;22;8;73;15;47;20;36;16;28;15;75;17;33;18;19;28;64;16;24;12;45;9;22;8;73;15;47;20;37;16;28;13;77;17;32;20;15;30;58;1;5;14;28;10;45;9;22;8;73;15;47;19;38;16;29;10;80;17;33;21;9;17;1;15;63;13;31;8;47;9;21;8;73;15;47;19;38;16;32;5;83;16;34;45;2;15;60;14;36;4;48;9;21;8;73;15;47;19;38;16;120;17;34;42;4;15;60;12;1;2;33;1;3;2;48;9;21;8;73;15;48;18;39;16;120;16;35;40;5;14;61;12;39;1;51;8;21;8;73;15;48;18;39;16;120;17;36;36;6;15;60;12;92;9;20;8;73;15;48;17;40;16;121;16;38;33;7;15;59;10;95;13;15;9;73;15;48;17;40;16;121;16;40;28;10;15;58;11;95;16;12;10;72;15;48;17;40;16;122;16;42;23;12;15;57;11;1;1;94;18;10;13;69;15;48;17;40;16;122;16;47;13;17;15;57;11;96;20;7;16;67;15;48;17;40;16;122;16;77;14;58;9;98;22;5;21;62;15;48;17;40;16;122;16;77;14;57;9;99;24;2;24;60;15;48;17;40;16;122;16;77;14;57;9;99;25;1;27;57;15;48;17;40;16;123;15;77;14;56;10;100;52;57;15;49;16;40;16;123;16;75;15;55;10;111;44;55;15;49;16;40;16;123;16;75;14;56;9;114;20;2;20;55;15;49;16;40;16;123;16;75;14;56;9;116;18;4;18;55;15;49;16;40;16;123;16;75;14;55;9;119;16;7;15;55;15;50;16;39;16;123;16;75;13;56;9;121;14;12;9;56;15;50;16;39;16;123;16;74;14;56;8;124;11;16;5;57;15;50;16;39;16;68;9;46;16;74;14;56;8;124;11;18;2;58;15;50;16;39;15;69;9;46;16;74;13;57;8;125;11;77;15;51;15;38;16;69;9;45;16;74;14;56;9;127;9;77;15;51;15;38;16;69;9;45;16;74;14;56;9;125;1;1;10;76;15;51;16;37;16;69;9;45;16;74;13;57;9;126;1;1;9;76;15;52;15;37;15;70;10;44;16;73;14;57;9;128;10;75;15;52;15;36;16;70;10;43;17;25;9;39;13;58;8;130;9;75;15;52;16;35;16;70;10;43;16;26;9;38;14;58;8;130;10;74;15;53;15;35;15;71;11;42;16;26;9;38;13;59;8;131;9;74;15;53;15;34;16;32;8;31;11;41;17;26;10;36;14;59;8;131;9;74;15;54;15;33;15;31;12;29;12;40;16;27;10;36;13;59;9;132;9;73;15;54;16;31;16;30;14;28;12;39;17;27;10;35;13;61;8;132;9;73;15;55;15;30;16;30;16;27;13;37;18;27;11;33;14;61;8;133;8;73;15;56;15;29;16;29;18;26;14;35;18;28;11;32;14;62;8;133;8;73;15;56;16;27;16;30;18;26;15;33;18;29;12;30;14;63;8;133;8;73;15;57;16;25;16;31;19;25;16;31;19;29;13;28;14;64;9;132;8;73;15;58;16;23;17;30;20;25;17;29;19;30;14;26;14;65;9;132;8;73;15;59;16;21;17;31;20;25;19;25;20;31;15;23;15;66;9;132;8;54;52;41;18;17;18;32;20;25;21;21;21;32;17;19;16;67;9;132;8;54;52;42;19;13;19;33;20;25;24;15;23;33;19;14;18;69;8;132;8;54;52;44;22;2;24;34;20;25;31;3;27;34;25;2;23;70;8;132;8;54;52;45;45;37;19;25;60;35;49;71;8;132;8;54;52;46;43;38;18;28;56;37;47;73;9;131;8;54;52;47;40;40;18;31;51;39;46;74;9;131;8;54;52;49;37;42;16;34;47;42;43;76;10;130;8;54;52;51;32;46;15;38;41;47;38;79;9;130;8;160;27;49;12;43;35;54;31;83;9;128;9;163;20;54;10;49;26;63;22;87;10;127;9;171;3;67;2;64;4;84;3;97;9;126;9;496;10;125;9;497;10;1;1;121;9;498;10;3;1;118;10;498;11;121;10;499;11;1;1;118;9;501;11;117;10;503;12;114;11;504;12;113;11;504;12;110;1;1;11;507;13;107;12;508;14;105;12;510;15;102;12;1;1;510;16;97;16;513;18;89;17;517;122;519;120;520;121;523;113;528;111;531;108;534;103;543;93;551;85;9199;6;76;5;117;5;265;12;154;6;52;10;12;7;24;8;12;9;19;11;12;8;13;6;13;9;241;15;72;4;79;4;50;14;9;8;22;11;9;12;17;13;10;11;9;8;12;11;240;5;5;5;72;4;79;4;50;5;4;5;8;9;22;5;2;5;7;5;4;5;16;5;4;5;8;5;3;5;7;9;11;5;3;5;238;5;7;4;72;4;79;4;50;4;6;5;7;3;1;5;21;4;5;5;6;4;6;4;16;3;7;5;6;5;5;4;7;4;1;4;10;5;6;4;237;4;9;3;72;4;79;4;50;3;8;4;7;2;2;5;21;4;6;4;5;5;7;4;15;3;7;5;6;4;6;5;6;2;3;4;10;4;7;4;237;4;9;3;72;4;79;4;50;3;8;4;11;5;20;4;7;5;4;4;8;4;15;2;9;4;5;5;7;4;11;4;9;5;7;5;236;4;10;2;7;10;6;7;1;7;3;7;9;9;4;12;4;10;10;8;1;6;26;7;1;4;9;9;5;7;1;7;23;4;11;5;20;4;8;4;4;4;8;5;25;4;5;4;8;4;11;4;9;5;8;4;236;5;17;12;5;16;1;9;6;12;3;12;3;12;8;16;24;14;7;12;4;15;23;4;11;5;20;4;8;4;4;4;8;5;25;4;5;4;8;4;11;4;9;5;8;4;236;7;15;4;4;5;4;26;6;4;4;4;5;4;9;4;3;5;7;6;2;7;26;5;2;7;6;5;4;5;3;15;23;4;11;5;20;4;8;4;4;4;8;5;24;5;5;4;8;5;10;4;9;5;8;4;237;9;12;3;6;4;7;5;4;6;4;5;4;4;6;3;5;4;9;3;6;4;5;5;5;6;25;5;5;5;6;4;6;4;6;5;4;3;22;5;11;5;19;5;8;4;4;4;8;5;24;4;6;4;8;5;10;4;9;5;7;5;237;12;9;2;8;3;7;5;5;5;5;4;4;4;7;2;5;4;9;2;7;4;5;5;6;5;25;4;7;4;5;5;6;5;5;5;5;2;22;4;12;5;19;5;8;4;4;5;6;6;24;4;6;4;8;5;10;4;10;4;7;5;239;12;17;4;6;4;6;4;6;4;4;5;13;4;19;3;5;4;7;5;24;5;7;4;5;4;8;4;5;4;29;4;13;5;19;5;8;4;5;5;5;6;23;4;7;4;8;5;10;4;10;5;5;6;241;11;8;12;6;4;6;4;6;4;5;7;10;4;11;11;4;5;8;4;24;5;7;4;5;4;8;4;5;4;28;5;13;5;19;5;8;4;5;16;22;4;8;4;8;5;10;4;11;15;245;8;5;14;6;4;6;4;6;4;5;10;7;4;9;13;4;5;8;4;24;5;7;4;5;16;5;4;27;5;14;5;19;5;8;4;6;15;21;5;8;4;8;5;10;4;12;14;247;6;4;8;3;4;6;4;6;4;6;4;6;11;5;4;8;7;4;3;4;5;8;4;24;4;8;4;5;16;5;4;26;5;15;5;20;4;8;4;8;7;2;4;20;5;9;4;8;5;10;4;14;7;1;4;249;5;3;5;6;4;6;4;6;4;6;4;9;9;4;4;8;4;7;3;4;5;8;4;24;5;7;4;5;4;17;4;25;5;16;5;20;4;8;4;16;4;20;4;11;4;8;4;11;4;22;4;236;3;10;5;3;4;7;4;6;4;6;4;6;4;12;6;4;4;7;5;7;3;4;5;8;4;24;5;7;4;5;4;17;4;24;5;17;5;20;4;8;4;16;4;19;4;12;4;8;4;11;4;22;4;236;3;10;5;3;4;7;4;6;4;6;4;6;4;4;3;7;4;4;4;7;5;6;4;5;4;7;5;24;5;7;4;5;4;9;3;5;4;23;5;5;3;10;5;20;4;7;5;16;4;18;4;6;2;5;5;7;4;11;4;21;4;237;3;10;4;4;4;7;4;6;4;6;4;6;4;4;3;7;4;4;4;3;3;1;5;6;4;5;5;6;5;25;4;7;4;5;5;7;4;5;4;22;5;6;3;10;5;12;2;7;4;6;4;6;3;7;5;6;3;8;4;7;2;6;4;6;5;11;4;11;2;8;4;237;4;8;5;4;4;6;5;6;4;6;4;6;4;4;4;6;4;4;4;3;3;2;4;6;4;5;5;5;6;6;4;15;5;5;5;6;4;7;4;5;4;21;5;7;3;10;5;11;4;6;4;5;5;6;3;7;4;6;5;6;4;8;2;6;5;5;4;12;4;11;3;6;4;238;6;5;6;4;6;3;6;6;4;6;4;6;4;4;5;4;5;4;5;1;4;2;6;2;6;6;6;2;7;6;4;16;5;2;7;6;6;3;5;6;4;20;16;10;5;10;5;7;5;2;5;7;5;3;5;7;5;5;15;7;5;3;5;12;4;11;4;4;5;238;16;6;16;1;9;1;9;2;8;2;13;6;9;3;16;4;14;6;4;16;17;4;12;4;10;17;16;6;13;6;5;7;11;8;12;8;5;4;16;8;11;9;12;7;12;241;12;9;15;1;9;1;9;2;8;3;11;7;8;5;8;1;6;5;8;1;4;6;4;18;15;6;9;5;10;17;16;6;13;7;4;9;8;9;11;9;5;4;16;9;8;11;12;7;10;372;3;6;4;626;4;5;5;616;3;7;4;4;5;617;3;7;4;5;3;618;4;4;5;627;13;628;10;1141;3200;3248;10;4;4;24;6;24;5;52;7;79;6;7;7;28;6;23;3;16;6;72;5;124;5;5;3;108;12;3;4;24;6;24;5;51;9;78;7;6;7;28;6;23;3;16;6;12;3;57;5;124;5;5;3;107;4;5;4;4;3;26;4;26;3;50;4;3;3;80;6;7;2;33;4;23;3;18;4;12;3;59;3;126;3;5;3;107;3;7;3;33;4;26;3;49;4;4;4;79;6;7;2;33;4;44;4;12;3;59;3;126;3;115;3;7;3;33;4;26;3;49;4;5;3;79;7;6;2;33;4;44;4;12;3;59;3;126;3;115;4;11;5;6;7;13;10;5;9;6;10;7;7;4;12;12;3;6;3;10;12;6;8;3;5;3;5;6;8;13;8;5;2;5;9;7;9;3;10;4;17;5;9;3;10;4;9;4;7;4;12;21;10;6;8;5;8;2;7;2;3;3;6;3;8;6;12;3;8;4;11;14;10;3;5;6;8;93;5;10;5;5;9;12;11;4;10;5;11;5;9;3;12;12;3;6;4;9;12;5;10;2;5;3;5;5;10;12;3;1;5;4;2;5;10;5;10;3;11;3;17;4;10;3;11;3;9;3;9;3;12;20;11;5;10;3;10;1;7;2;4;2;6;2;10;4;13;2;10;3;12;12;11;3;5;5;10;92;8;9;3;4;4;3;4;11;5;2;4;4;3;4;3;5;4;4;4;3;4;3;4;4;5;2;4;11;3;6;4;11;5;2;4;3;4;4;4;3;3;5;3;4;4;3;4;12;3;2;4;4;2;5;3;4;3;4;4;4;3;3;5;2;4;5;5;2;2;2;4;3;4;4;3;3;5;2;4;5;3;6;4;3;4;4;5;2;4;18;5;3;4;4;4;3;4;3;3;4;3;3;3;4;4;4;2;3;4;3;4;3;4;3;5;4;3;4;4;4;4;2;4;12;4;3;4;5;3;4;4;3;4;93;10;6;3;3;4;5;3;11;4;4;3;4;2;5;4;4;4;4;4;2;4;5;3;4;4;3;4;11;3;6;4;11;4;3;4;3;3;5;4;3;3;5;3;4;3;5;4;11;3;2;5;3;2;5;2;5;3;4;4;5;2;3;4;4;3;5;4;3;2;2;4;3;4;5;2;3;4;4;3;5;3;5;4;5;3;4;4;3;4;18;4;4;4;4;3;5;4;2;3;4;3;3;3;3;5;3;3;3;3;5;4;2;4;4;4;3;4;5;3;4;3;4;4;10;4;5;3;5;3;4;3;5;4;94;9;5;3;3;13;10;4;4;3;8;7;4;3;6;3;2;13;3;3;5;3;11;3;6;4;11;3;5;3;3;12;3;3;5;3;3;13;11;3;3;5;2;2;9;6;4;3;6;2;3;4;4;3;5;3;8;4;3;3;6;2;3;4;4;3;5;3;5;13;3;3;5;3;18;3;6;3;3;13;2;4;9;4;2;6;2;2;3;13;2;3;6;3;3;12;4;3;4;4;10;4;5;3;5;3;3;13;97;7;4;3;3;13;10;4;4;3;5;10;4;3;6;3;2;13;3;3;5;3;11;3;6;4;11;3;5;3;3;12;3;3;5;3;3;13;11;3;4;4;2;2;6;9;4;3;11;4;4;3;5;3;8;4;3;3;11;4;4;3;5;3;5;13;3;3;5;3;18;3;6;3;3;13;2;7;7;3;2;6;2;2;3;13;2;3;6;3;3;12;4;3;4;4;10;4;5;3;5;3;3;13;100;4;4;3;3;13;10;4;4;3;4;11;4;3;6;3;2;13;3;3;5;3;11;3;6;4;11;3;5;3;2;13;3;3;5;3;3;13;11;3;5;4;1;2;5;10;3;4;11;4;4;3;5;3;8;4;2;4;11;4;4;3;5;3;5;13;3;3;5;3;18;3;6;3;3;13;3;8;5;3;1;3;1;3;1;3;3;13;1;4;6;3;3;13;3;3;4;4;10;3;6;3;5;3;3;13;91;2;8;3;4;3;3;4;19;4;4;3;3;4;5;3;4;3;6;3;2;4;12;3;5;3;11;3;6;3;12;3;5;3;3;3;12;3;5;3;3;4;20;3;5;7;4;4;4;3;4;3;11;4;4;3;5;3;8;4;3;3;11;4;4;3;5;3;5;4;12;3;5;3;18;3;6;3;3;4;14;7;4;7;1;3;1;3;3;4;11;3;6;3;3;3;13;3;4;4;10;4;5;3;5;3;3;4;100;2;8;3;4;3;3;4;6;3;10;4;4;3;3;4;5;3;4;3;6;3;2;4;6;3;3;3;5;3;11;4;5;3;12;3;5;3;3;3;6;3;3;3;5;3;3;4;6;3;11;3;6;6;4;3;5;3;4;3;6;3;2;4;4;3;5;3;8;4;3;3;6;3;2;4;4;3;5;3;5;4;6;3;3;3;5;3;18;3;6;3;3;4;6;3;8;4;4;6;2;6;4;4;6;3;2;3;6;3;3;4;5;3;4;3;4;4;10;4;5;3;5;3;3;4;6;3;91;3;7;3;4;3;3;4;5;3;11;4;4;3;3;4;4;4;4;4;4;4;2;4;5;3;4;3;5;3;11;4;4;4;12;3;5;3;3;4;5;3;3;3;4;4;4;3;6;3;11;3;7;5;4;3;5;3;4;4;5;3;2;4;4;3;5;3;8;4;3;4;5;3;2;4;4;3;5;3;2;2;1;4;5;3;4;3;5;3;18;4;4;4;4;3;6;3;2;2;5;3;5;5;3;5;5;3;6;3;2;4;4;4;3;4;5;3;4;3;4;4;10;4;5;3;5;3;4;3;6;3;91;4;5;4;4;3;4;4;4;3;11;4;4;3;3;4;4;4;4;4;4;4;3;4;4;3;4;3;5;3;12;4;3;3;13;3;5;3;3;4;4;4;3;4;3;4;4;4;4;3;12;3;8;4;4;4;3;4;4;4;4;3;3;4;4;3;5;3;8;4;3;4;4;3;3;4;4;3;5;3;2;2;2;4;4;3;4;3;5;3;4;4;10;5;3;4;4;4;4;3;3;3;4;3;5;5;3;5;5;4;4;3;3;4;3;5;4;4;3;4;4;3;4;4;11;4;3;4;5;3;4;4;4;3;92;12;3;7;3;9;11;6;1;7;2;26;5;9;3;7;1;7;11;9;11;7;1;7;2;10;5;12;3;10;10;7;7;3;5;12;3;10;2;6;1;7;1;8;3;8;2;10;2;6;1;7;3;7;3;9;3;7;1;7;2;3;12;13;3;10;3;10;5;4;4;4;7;10;4;11;4;10;3;7;1;7;9;13;1;7;3;10;93;10;4;7;4;7;12;6;1;7;3;24;7;7;4;7;1;7;12;7;12;7;1;7;3;8;6;12;4;8;11;7;7;3;5;12;4;8;3;6;1;7;1;8;3;8;3;8;3;6;1;7;3;7;4;7;4;7;1;7;2;3;13;12;4;8;4;9;7;3;5;3;8;8;6;10;5;8;4;7;1;7;10;12;1;7;4;8;462;4;97;3;535;4;90;2;5;4;535;3;91;2;5;3;630;10;630;9;3771;5;366;5;49;5;3;5;62;6;7;7;69;4;7;13;10;12;4;7;8;10;347;5;12;3;34;5;3;5;17;3;42;7;6;7;67;6;7;13;10;12;4;8;6;13;347;3;12;3;36;3;5;3;17;3;45;5;7;3;68;7;7;2;7;3;11;2;7;3;4;2;3;3;5;4;5;5;347;3;12;3;36;3;5;3;17;3;45;6;6;3;68;7;7;2;7;3;11;2;6;4;4;2;3;3;4;4;7;4;347;3;12;3;36;3;5;3;17;3;45;6;6;3;68;1;2;4;7;2;6;3;12;2;6;3;5;3;2;3;3;4;9;3;333;8;6;3;3;22;2;5;6;8;5;3;5;3;4;9;2;9;4;7;4;12;14;7;5;3;6;8;3;6;3;3;3;5;2;9;23;4;15;3;20;3;5;7;4;4;9;3;332;10;5;3;3;22;2;5;5;10;4;3;5;3;4;9;2;9;3;9;3;12;14;2;1;5;4;3;5;10;2;6;3;3;3;5;2;9;23;4;14;4;19;3;7;6;4;4;344;3;4;4;4;3;3;4;5;3;6;4;4;3;4;4;4;4;3;3;5;3;3;3;4;3;4;3;6;4;3;4;4;5;2;4;13;2;2;5;3;3;4;4;3;4;3;4;3;5;3;3;2;3;4;3;4;3;16;4;14;3;20;3;17;3;345;3;5;3;4;3;2;4;6;3;6;4;4;3;4;3;5;4;3;3;5;3;3;3;5;2;4;3;5;4;5;3;4;4;3;4;13;2;3;4;3;3;4;3;5;4;3;3;3;5;3;3;2;3;5;2;4;4;15;4;14;3;19;3;18;3;350;6;4;3;1;4;7;3;6;4;4;3;4;12;3;3;5;3;3;5;9;3;5;13;3;3;5;3;13;2;3;5;2;3;3;13;3;3;3;5;3;2;3;5;9;4;15;4;13;3;20;3;18;3;346;10;4;7;8;3;6;4;4;3;4;12;3;3;5;3;4;7;6;3;5;13;3;3;5;3;13;2;4;5;1;3;3;13;3;4;1;7;1;3;4;7;7;2;16;4;13;3;20;3;18;3;345;11;4;8;7;3;6;4;4;3;3;13;3;3;5;3;5;8;4;3;5;13;3;3;5;3;13;2;5;4;1;3;3;13;4;3;1;7;1;3;5;8;23;4;12;3;20;3;19;4;344;4;4;3;4;4;1;4;6;3;6;4;4;3;4;3;12;3;5;3;7;7;3;3;5;4;12;3;5;3;13;2;6;7;3;4;13;3;1;2;2;3;1;2;8;7;22;4;12;3;20;3;19;4;343;4;5;3;4;3;2;4;6;3;6;4;4;3;4;3;6;3;3;3;5;3;10;4;3;3;5;4;6;3;3;3;5;3;13;2;6;7;3;4;6;3;4;6;2;6;11;4;22;4;12;3;19;3;20;4;9;3;331;4;5;3;4;3;3;4;5;3;2;2;2;4;4;3;4;4;5;3;3;3;5;3;3;2;6;3;3;3;2;2;1;4;5;3;4;3;5;3;13;2;7;6;4;3;6;3;5;5;2;6;4;2;6;3;4;2;16;4;11;3;10;2;8;3;21;4;7;4;332;4;3;4;4;3;4;4;4;3;2;2;3;3;3;4;4;4;4;4;3;3;5;3;3;3;4;4;3;3;2;2;2;4;4;3;4;3;5;3;13;2;8;5;4;4;4;3;6;4;4;4;5;3;4;4;3;4;15;4;11;3;9;4;7;3;22;4;5;4;333;20;1;7;2;7;3;12;3;10;2;7;1;7;1;10;4;7;3;9;3;7;1;7;8;7;7;4;5;10;6;4;4;4;5;10;4;4;12;10;7;3;10;4;6;3;24;11;335;19;1;7;2;7;4;11;4;8;3;7;1;7;1;9;5;7;4;7;4;7;1;7;8;7;8;3;6;8;7;4;4;4;5;9;5;3;13;10;7;3;10;3;7;3;25;9;20649;";

void setupOld() {
  Serial.begin(115200);
  iot.begin();
  display.init(); // enable diagnostic output on Serial

  //Use the web object to add elements to the interface
  iot.web.addInterfaceElement("color", "input", "", "#configform", "LampColor");
  iot.web.setInterfaceElementAttribute("color", "type", "text");

  Serial.println("Hello world");
  counter = 0;

  client.setRxTimeout(10);            // 5 sec timeout
  client.onConnect(&onConnectHandler);
  client.onData(&onDataHandler);
  client.onDisconnect(&onDisconnectHandler);
  client.onTimeout(&onTimeoutHandler);
  client.onError(&onErrorHandler);

  delay(10000);
  // connectToRaspi();
}

void setup() {
  Serial.begin(115200);
  display.init(); // enable diagnostic output on Serial

  WiFi.begin("Forum", "Hack2019");
  while(WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  
  Serial.println("Hello world");
  counter = 0;

  client.setRxTimeout(10);            // 5 sec timeout
  client.onConnect(&onConnectHandler);
  client.onData(&onDataHandler);
  client.onDisconnect(&onDisconnectHandler);
  client.onTimeout(&onTimeoutHandler);
  client.onError(&onErrorHandler);

  // connectToRaspi();
}

void loop() {
//  touchValueLeft = touchRead(touchPinLeft);
//  if(touchValueLeft < 50) {
//    Serial.println(String("Left Below 50: ") + touchValueLeft);
//  }
//  touchValueRight = touchRead(touchPinRight);
//  if(touchValueRight < 50) {
//    Serial.println(String("Right Below 50: ") + touchValueRight);
//  }
  touchValueBottom = touchRead(touchPinBottom);
  if(touchValueBottom < 50) {
    Serial.println(String("Bottom Below 50: ") + touchValueBottom);
  }

  if( (baseClock % 30000) == 0) {
    connectToRaspi();
    //showFont("FreeMonoBold12pt7b", &FreeMonoBold12pt7b);
    delay(8000);
    drawBlackPixelOld(displayValue);
    // drawBlackPixelSimple();
  }

  baseClock = baseClock + 1500;
  delay(2000);
  // Serial.print(".");
}

void connectToRaspi() {
  if (WiFi.status() == WL_CONNECTED) {
      const int httpPort = 5000;
      const char* host = serverUrl;

      if (!client.connect(host, httpPort)) {
        Serial.println("connection failed");
      } else {
        Serial.println("Wait till the client is connected");
      }
    } else {
      Serial.println("WLAN not conntected");
    }
}

/*
void showFont(const char name[], const GFXfont* f) {
  display.fillScreen(GxEPD_WHITE);
  display.setTextColor(GxEPD_BLACK);
  display.setFont(f);
  display.setCursor(0, 0);
  display.println();
  display.println("Hello world");
  display.println(counter);
  display.println(name);
  display.update();
  delay(5000);
}

void showByteArrayWithLength(String data, size_t len, boolean start) {
  static int x = 0;
  static int y = 0;
  boolean isBlack = false;
  int pixelCounter;
  String currentCounter;
  String dataLeft = data;

  display.fillScreen(GxEPD_WHITE);

  while(dataLeft.length() > 0) {
    int indexNext = dataLeft.indexOf(";");
    if(indexNext < dataLeft.length()) {
      currentCounter = dataLeft.substring(0, indexNext);
      dataLeft = dataLeft.substring(indexNext + 1);
      pixelCounter = currentCounter.toInt();
      for(int i = 0; i < pixelCounter; i++) {
        lengthPixel += 1;
        if(isBlack == true) {
          display.drawPixel(x, y, GxEPD_BLACK);
        }
        x++;
        if(x == 640) {
          y++;
          x = 0;
        }
      }
      isBlack = !isBlack;
    }
  }
  display.update();
}*/

/* - - - - AsyncClient Handler - - - - - - - */
void onConnectHandler(void *r, AsyncClient *client){
  Serial.println("OnConnect\n");

  String query = String("GET ") + dataPath + " HTTP/1.1\r\n" +
                 "Host: " + serverUrl + "\r\n" +
                 "Connection: close\r\n\r\n";
  client->write(query.c_str());
}

void onDataHandler(void *r, AsyncClient *client, void *data, size_t len){
  String text = String((char*) data);
  Serial.println(String("New data: ") + text.length());
  int indexContentStart = text.indexOf("Lorem");
  if(indexContentStart != -1) {
    displayValue = "";
    text = text.substring(indexContentStart + 5);
  }
  int indexContentEnd = text.indexOf("ipsum");
  if(indexContentEnd != -1) {
    text = text.substring(0, indexContentEnd);
  }
  if(!text.startsWith("HTTP")) {
    displayValue += text;
  } else {
    Serial.println(text);
  }
}

void onTimeoutHandler(void *r, AsyncClient *client, uint32_t timeout){
  Serial.println(String("Timeout ") + timeout);
}

void onDisconnectHandler(void *r, AsyncClient *client){
  Serial.println("OnDisconnect");
}


void drawBlackPixelSimple() {
  Serial.println("black pixel simple");
  display.fillScreen(GxEPD_WHITE);
  for(int i = 0; i < 300; i += 1 ) {
    display.drawPixel(i, 1, GxEPD_BLACK);
  }
  display.update();
}

void drawBlackPixel(String dataLeft) {
  int x = 0;
  int y = 0;
  boolean isBlack = false;
  int pixelCounter = 0;
  String currentCounter = "";
  // String dataLeft = data;
  String line = "";
  dataLeft.trim();

  Serial.println(String("Start draw black pixel: ") + dataLeft.length());
  
  display.fillScreen(GxEPD_WHITE);
  display.setCursor(0,0);

  while(dataLeft.length() > 0) {
    int indexNextLine = dataLeft.indexOf(":");
    if(indexNextLine < dataLeft.length()) {
      Serial.println(String("Index Länge:") + indexNextLine);
      line = dataLeft.substring(0, indexNextLine);
      dataLeft = dataLeft.substring(indexNextLine + 1);
      Serial.println(String("Line:") + line);
      // Serial.println(line);
      while(line.length() > 0) {
        
        int indexNextValue = line.indexOf(";");
        if(indexNextValue < line.length()) {
          currentCounter = line.substring(0, indexNextValue);
          line = line.substring(indexNextValue + 1);
          pixelCounter = currentCounter.toInt();
          for(int i = 0; i < pixelCounter; i++) {
            if(isBlack == true) {
              display.drawPixel(x, y, GxEPD_BLACK);
            }
            x++;
            if(x == 640) {
              Serial.println(String("Wechsel in neue Zeile in Schleife"));
              y++;
              x = 0;
            }
          }
          isBlack = !isBlack;
        }
      }
      if(x != 0) {
        Serial.println("Wechsel in neue Zeile nach zu kurzer Zeile");
        y++;
        x = 0;
      }
    }
  }
  display.update();
  Serial.println("Updated screen");
}

void drawBlackPixelOld(String dataLeft) {
  int x = 0;
  int y = 0;
  boolean isBlack = false;
  int pixelCounter = 0;
  int pixelCounter2 = 0;
  String currentCounter = "";
  dataLeft = content;
  dataLeft.trim();

  Serial.println(String("Start draw black pixel old: ") + dataLeft.length());
  
  display.fillScreen(GxEPD_WHITE);
  display.setCursor(0,0);
  
  while(dataLeft.length() > 0) {
    int indexNextValue = dataLeft.indexOf(";");
    
    if(indexNextValue < dataLeft.length()) {
      currentCounter = dataLeft.substring(0, indexNextValue);
      pixelCounter = currentCounter.toInt();
      dataLeft = dataLeft.substring(indexNextValue + 1);
//      int indexNextValue2 = dataLeft.indexOf(";");
//      
//      if(indexNextValue2 < dataLeft.length()) {
//        currentCounter = dataLeft.substring(0, indexNextValue2);
//        dataLeft = dataLeft.substring(indexNextValue2 + 1);
//        // Serial.println(String("Is digit pixelCounter2") + currentCounter.charAt(0).isDigit());
//        pixelCounter2 = currentCounter.toInt();
//        
//        if(pixelCounter != pixelCounter2 && pixelCounter2 != 0) {
//          pixelCounter = pixelCounter2;
//        }
        for(int i = 0; i < pixelCounter; i++) {
          if(isBlack == true) {
            display.drawPixel(x, y, GxEPD_BLACK);
          }
          x++;
          if(x == 640) {
            y++;
            x = 0;
          }
        }
        isBlack = !isBlack;
      }
    // }
  }
  display.update();
  Serial.println("Updated screen");
}

void onErrorHandler(void *r, AsyncClient *client, int8_t error){
  Serial.println(String("Error:") + error);
}
